<div class="orders-page page">
  <div class="d-flex justify-content-between">
    <h2>
      Orders
      <button
        type="button"
        [routerLink]="['/orders/', 'create']"
        *ngIf="authService.getUserRole() == 'client'"
        class="btn btn-warning"
      >
        New order
      </button>
    </h2>
  </div>
  <router-outlet></router-outlet>

  <div *ngIf="count" class="alert alert-warning" role="alert">
    Total number of orders: {{ count }}
  </div>
  <div *ngIf="!count" class="alert alert-primary" role="alert">
    <i class="bi bi-info-circle-fill"></i> No orders
  </div>
  <div
    class="alert alert-danger"
    *ngIf="count == 0 && role == 'driver'"
    role="alert"
  >
    <i class="bi bi-info-circle-fill"></i> You dont have completed orders.
  </div>

  <div
    class="alert alert-danger"
    *ngIf="!carNum && role == 'driver'"
    role="alert"
  >
    <i class="bi bi-info-circle-fill"></i> Add your car, otherwise you cant
    work!
  </div>

  <table
    *ngIf="role == 'admin'||
    role == 'dispatcher'||
      role == 'client' ||
      (count && role != 'driver') ||
      (count && carNum!=0 && role == 'driver')
    "
    class="table table-hover"
  >
    <thead>
      <tr>
        <th *ngIf="role !== 'client'">Client</th>
        <th scope="col">Driver</th>
        <th *ngIf="role !== 'client'" scope="col">Dispatcher</th>
        <th scope="col">Origin address</th>
        <th scope="col">Destination</th>
        <th scope="col">Payment</th>
        <th scope="col">Date</th>

        <th scope="col">Approved</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let order of orders; first as isFirst"
        [routerLink]="['/orders/', order.order_id]"
      >
        <td *ngIf="role !== 'client'">
          {{ !order.client_id  ? "No info": order.client_name  }}
        </td>
        <td>{{ !order.driver_id ? "No info": order.driver_name }}</td>
        <td *ngIf="role !== 'client'">{{ !order.dispatcher_id ? "No info": order.dispatcher_name }}</td>
        <td>{{ order.origin_address }}</td>
        <td>{{ order.destination_address }}</td>
        <td>{{ !order.total_payment ? "No info" : order.total_payment}}</td>
        <td>{{ order.creation_date | date: "MM/dd/yy, h:mm a" }}</td>
        <td class="approved">
          <i *ngIf="order.approved" class="bi bi-check-lg"></i>
          <i *ngIf="!order.approved" class="bi bi-x-lg"></i>
        </td>

      </tr>
    </tbody>
  </table>
  <nav *ngIf="(count && role != 'driver') || (carNum && role == 'driver')">
    <ul class="pagination justify-content-center">
      <li
        *ngFor="let page of [].constructor(pages); let i = index"
        class="page-item"
      >
        <a class="page-link" (click)="getOrders(i + 1)">{{ i + 1 }}</a>
      </li>
    </ul>
  </nav>
</div>
